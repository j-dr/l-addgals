#!/usr/bin/env python
from __future__ import print_function, division
from rdel import config
import sys

cfgfile = sys.argv[1]

cfg = config.readCfg(cfgfile)
sim, lf, m = config.parseConfig(cfg)

for s in sim:

    if cfg['AbundanceMatch']['run']:
        s.abundanceMatch(lf, cfg['AbundanceMatch']['outdir'],
                         parallel=cfg['AbundanceMatch']['parallel'])
        
    if cfg['RdelModel']['run']:
        parallel = cfg['RdelModel'].pop('parallel', False)
        debug    = cfg['RdelModel'].pop('debug', False)
        startat  = cfg['RdelModel'].pop('startat', None)

        s.rdelMagDist(lf, parallel=parallel, debug=debug,
                        startat=startat)
    
